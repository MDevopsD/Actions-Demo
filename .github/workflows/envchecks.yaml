name: Conditional Directory via Input or Schedule

on:
  workflow_dispatch:
    inputs:
      env_type:
        description: 'Environment type (production or test)'
        required: false
        default: 'production'

  schedule:
    - cron: '*/5 * * * *'  # Every 5 minutes for testing

jobs:
  set-dir-based-on-env:
    runs-on: ubuntu-latest
    env:
      DIR_PRD: /path/prd
      DIR_TEST: /path/test

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set DIR based on env_type or schedule
        run: |
          # Interpolate GitHub context into a shell variable
          ENV_TYPE="${{ github.event_name == 'schedule' && 'production' || inputs.env_type }}"

          echo "Selected env_type: $ENV_TYPE"

          # Validate env_type
          if [ "$ENV_TYPE" != "production" ] && [ "$ENV_TYPE" != "test" ]; then
            echo "❌ Invalid env_type: $ENV_TYPE"
            echo "Allowed values are: production, test"
            exit 1
          fi

          # Set DIR based on env_type
          if [ "$ENV_TYPE" = "production" ]; then
            echo "DIR=${DIR_PRD}" >> $GITHUB_ENV
          else
            echo "DIR=${DIR_TEST}" >> $GITHUB_ENV
          fi

      - name: Show directory and run script
        run: |
          echo "Using directory: $DIR"
          # Simulate script execution
          echo "Running in directory: $DIR"
