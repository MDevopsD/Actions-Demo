name: Detect Recent File Changes

on:
  push:             # Triggered on any push
  workflow_dispatch: # Optional: allow manual trigger

jobs:
  check-for-changes:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout the code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Get full history for git diff to work

      - name: Check for file changes in the last hour (dynamic branch, single-step)
        id: check_changes
        run: |
          BRANCH="${GITHUB_REF#refs/heads/}"
          echo "üîç Checking for file changes on origin/$BRANCH in the last hour..."

          git fetch origin "$BRANCH"

          LAST_COMMIT=$(git rev-list -1 --before='1 hour ago' "origin/$BRANCH")
          echo "üïì Last commit before 1 hour ago: $LAST_COMMIT"

          CHANGES=$(git diff --name-only "origin/$BRANCH" "$LAST_COMMIT")

          if [ -n "$CHANGES" ]; then
            echo "‚úÖ File changes detected:"
            echo "$CHANGES"
            echo "changed=true" >> "$GITHUB_OUTPUT"
          else
            echo "‚ÑπÔ∏è No file changes detected in the last hour."
